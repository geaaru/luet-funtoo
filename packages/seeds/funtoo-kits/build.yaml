requires:
  - name: funtoo-gnome-stage3
    category: "seed"
    version: ">=0"
env:
- JOBS=10
- GIT_HISTORY_ENTRIES=3000
- FEATURES="-sandbox -usersandbox -ipc-sandbox -pid-sandbox -network-sandbox"
- LUET_YES=true
- LUET_NOLOCK=true
prelude:
- >-
  mv kits-versions / &&
  curl https://raw.githubusercontent.com/geaaru/luet/geaaru/contrib/config/get_luet_root.sh | sh &&
  luet install
  repository/mottainai-stable
  system/luet-devkit &&
  luet install --sync-repos
  dev-util/pkgs-checker-minimal utils/yq &&
  luet install system/entities --sync-repos && luet upgrade &&
  luet cleanup &&
  ego sync &&
  cd /var/git/meta-repo/kits &&
  ls -l &&
  for i in $(ls .) ; do
  echo $i ;
  if [ -e /kits-versions/$i.yml ] ; then
  hash=$(yq r /kits-versions/$i.yml 'commit') ;
  echo "For kit $i set hash $hash" ;
  pushd $i ;
  git pull -ff --depth=$GIT_HISTORY_ENTRIES ;
  git checkout $hash || exit 1 ;
  popd ;
  fi ;
  done
# Temporary fix this until we update all kits
- >-
  sed /etc/portage/make.profile/parent
  -e 's|.*gfxcard-kvm$||g' | sed '/^$/d' >
  /etc/portage/make.profile/parentnew &&
  rm /etc/portage/make.profile/parent &&
  mv /etc/portage/make.profile/parentnew /etc/portage/make.profile/parent
- >-
  cp patches/libical-3.0.11.ebuild /var/git/meta-repo/kits/core-kit/dev-libs/libical/ &&
  cd /var/git/meta-repo/kits/core-kit/dev-libs/libical &&
  ebuild libical-3.0.11.ebuild digest
- >-
  rm /var/git/meta-repo/kits/dev-kit/dev-util/kbuild -rf &&
  cp patches/kbuild /var/git/meta-repo/kits/dev-kit/dev-util/ -rf &&
  cd /var/git/meta-repo/kits/dev-kit/dev-util/kbuild &&
  ebuild kbuild-0.1.9998.3407.ebuild digest
- >-
  cp patches/java/* /var/git/meta-repo/kits/java-kit/ -rfv &&
  cd /var/git/meta-repo/kits/java-kit/dev-java/openjdk-bin/ &&
  ebuild openjdk-bin-11.0.13_p8.ebuild digest &&
  ebuild openjdk-bin-17.0.1_p12.ebuild digest &&
  cd /var/git/meta-repo/kits/java-kit/dev-java/openjdk-jre-bin/ &&
  ebuild openjdk-jre-bin-11.0.11_p9.ebuild digest
- >-
  cp patches/text-kit/* /var/git/meta-repo/kits/text-kit/ -rfv

